---
title: Pod scheduling issue
exercise: 5
date: '2020-01-05'
tags: ['easy']
draft: false
authors: ['default']
summary: "Why is this pod not being scheduled?"
---


You recently heard in the news that a young kid managed to hit a theoretical Tetris High Score that triggers a bug.
This remind you of the old good time, and you managed to create all the required resource to play Tetris on your cluster (only during lunch break)
But something still not working, and your pod doesn't deploy.

Go, fix it, and slam that high score.
Good luck!


<TOCInline toc={props.toc} asDisclosure />


## What's going on?

You head straight to the `exercise05-userXX` namespace, pick the "Developer perspective", check the topology view. You see this
light blue deployment, and as an experienced OpenShift user, you know it should be dark blue!

<Zoom>
![topology](/static/images/exercise5/problem.png)
</Zoom>

Poke around, click, explore, and fix it!

Note: If you try to use a "lazy" shortcut solution, you may hit an error from a custom webhook admission controller.

## Hints
### Hint 1
<details>
  <summary>How to quickly see the pod status?</summary>

You probably already found that the Pod is unschedulable.
<Zoom>
![hint1](/static/images/exercise5/hint1.png)
</Zoom>
The message indicates it's something to do with pod's node affinity/selector.

</details>

### Hint 2
<details>
  <summary>How to check the pod events?</summary>

You probably had a quick look at the pod events, to see if you get more information.
<Zoom>
![hint2](/static/images/exercise5/hint2.png)
</Zoom>
Nothing new. Keep digging!

</details>

### Hint 3
<details>
  <summary>How to check the pod status/message?</summary>

The source of truth is often in the Yaml itself, so you probably decided to check
the current yaml of the deployment.
<Zoom>
![hint3](/static/images/exercise5/hint3.png)
</Zoom>
Nothing new. Keep digging!

</details>

### Hint 4
<details>
  <summary>How to check pod's node affinity?</summary>

Let's first check if there is some affinity setup on this pod, and if that's what
is preventing the scheduling. There is no convenient way to check that (that I know of), so we
should check the Yaml file, i.e. with the search feature.

<Zoom>
![hint4](/static/images/exercise5/hint4.png)
</Zoom>

No affinity issue, moving on to node selector, maybe?

</details>

### Hint 5
<details>
  <summary>How to check pod's node selector?</summary>

Pod selector can be visualize through the Details view of the pod, or replicaSet, or Deployment.

In the image below, we check from the Pod details view.

<Zoom>
![hint5](/static/images/exercise5/hint5.png)
</Zoom>

So yes, there is some nodeSelector setup. To select which node(s) exactly?

There is this nice link to trigger a search on the node selector label

<Zoom>
![hint5](/static/images/exercise5/hint5-2.png)
</Zoom>

Mmmm no nodes with this label found. No wonder it's not working.
It's probably a good time to check a bit the nodeSelector documentation here: https://docs.openshift.com/container-platform/4.15/nodes/scheduling/nodes-scheduler-node-selectors.html

You may be tempted to simply delete the nodeSelector section of the pod (in fact, it should be done in the template section of the Deployment, to make sure future
pods are also affected by your change). However, I added a validating webhook that will prevent any pod without a nodeSelector to be created in this namespace.
Just to make sure you find a proper solution...

</details>

### Hint 6
<details>
  <summary>How to check labels on node?</summary>

If your role have the appropriate permission to `get & list nodes` (which is the case today),
you should be able to see the nodes from the Administrator perspective.

<Zoom>
![hint6](/static/images/exercise5/hint6.png)
</Zoom>

And then you should be able to see the Details view of the node, which includes it's label

<Zoom>
![hint7](/static/images/exercise5/hint7.png)
</Zoom>

</details>

Enough hints for today, you should be able to fix it, otherwise have a look at the solution!

## Solution


## Did you know?

### something to know


### something else to know


## Take away
Some summary
- point 1
- point 2


